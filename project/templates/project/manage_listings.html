{% extends 'project/base.html' %}

{% block title %}Manage My Listings{% endblock %}

{% block content %}
    <div class="manage-listings-container">
        <h2>Manage My Listings</h2>
        {% if listings %}
            <table class="manage-listings-table">
                <thead>
                    <tr>
                        <th>Item</th>
                        <th>Price</th>
                        <th>Category</th>
                        <th>Date Listed</th>
                        <th>Status</th>
                        <th>Buyer Address</th>
                        <th>Update Order Status</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                
                <tbody>
                    {% for listing in listings %}
                        <tr>
                            <td>{{ listing.name }}</td>
                            <td>${{ listing.price }}</td>
                            <td>{{ listing.category }}</td>
                            <td>{{ listing.created_at|date:"F d, Y" }}</td>
                            <td>{{ listing.sold|yesno:"Sold,Available" }}</td>
                            
                            <!-- Buyer Address -->
                            <td>
                                {% for order in orders %}
                                    {% if order.listing.id == listing.id %}
                                        {{ order.buyer.profile.address }}
                                    {% endif %}
                                {% endfor %}
                            </td>
                
                            <!-- Update Order Status -->
                            <td>
                                {% for order in orders %}
                                    {% if order.listing.id == listing.id %}
                                        <form method="post" action="{% url 'update_order_status' order.id %}">
                                            {% csrf_token %}
                                            <select name="status" class="dropdown-select">
                                                <option value="Pending" {% if order.status == "Pending" %}selected{% endif %}>Pending</option>
                                                <option value="Paid" {% if order.status == "Paid" %}selected{% endif %}>Paid</option>
                                                <option value="Shipped" {% if order.status == "Shipped" %}selected{% endif %}>Shipped</option>
                                                <option value="Delivered" {% if order.status == "Delivered" %}selected{% endif %}>Delivered</option>
                                            </select>
                                            <button type="submit" >Update</button>
                                        </form>
                                    {% endif %}
                                {% endfor %}
                            </td>
                
                            <!-- Actions -->
                            <td>
                                <button><a href="{% url 'listing_detail' listing.id %}">View</a></button>
                                <button><a href="{% url 'edit_listing' listing.id %}">Edit</a></button>
                                <form method="post" action="{% url 'delete_listing' listing.id %}" style="display:inline;">
                                    {% csrf_token %}
                                    <button type="submit" onclick="return confirm('Are you sure you want to delete this listing?');">Delete</button>
                                </form>
                            </td>
                        </tr>
                    {% endfor %}
                </tbody>
                
            </table>
        {% else %}
            <p>You have no listings to manage.</p>
        {% endif %}
    </div>
{% endblock %}
